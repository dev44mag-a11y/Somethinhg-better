<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tropical Revolution - Expandido</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            color: white;
            min-height: 100vh;
            padding: 20px;
            transition: background 1s ease;
            background: linear-gradient(135deg, #b8e9c3 0%, #00B4D8 100%);
            background-attachment: fixed;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.7);
        }

        /* Banana Container - Background Animado */
        .banana-container {
            position: fixed;
            inset: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
            opacity: 0.18;
            overflow: hidden;
        }

        .banana {
            position: absolute;
            font-size: 2rem;
            will-change: transform, opacity, filter;
            filter: drop-shadow(0 2px 2px rgba(0,0,0,0.15));
            transition: transform 400ms ease, opacity 400ms ease;
            opacity: 0.9;
        }

        @keyframes glow {
            0%, 100% { 
                text-shadow: 0 0 5px #FFD23F, 0 0 10px #FFD23F;
                opacity: 0.8;
            }
            50% { 
                text-shadow: 0 0 10px #FFD23F, 0 0 20px #FFD23F, 0 0 30px #FFD23F;
                opacity: 1;
            }
        }

        @keyframes strongGlow {
            0% { filter: drop-shadow(0 0 0 rgba(255,210,63,0)); transform: scale(1) rotate(var(--r)); }
            50% { filter: drop-shadow(0 6px 12px rgba(255,210,63,0.85)) blur(1px); transform: scale(1.22) rotate(var(--r)); }
            100% { filter: drop-shadow(0 0 0 rgba(255,210,63,0)); transform: scale(1) rotate(var(--r)); }
        }

        .banana-glow {
            animation: glow 1.6s ease-in-out forwards;
            transform: scale(1.15) rotate(var(--r));
            opacity: 1;
        }

        .banana-glow.strong {
            animation: strongGlow 1.2s ease-in-out forwards;
            opacity: 1;
        }

        /* Resto do CSS */
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.6);
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: #ffcc00;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .game-area {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .island-map {
            background: linear-gradient(to bottom, #87CEEB, #32CD32);
            border: 3px solid #8B4513;
            border-radius: 10px;
            height: 500px;
            position: relative;
            overflow: hidden;
        }

        .zone {
            position: absolute;
            border: 2px dashed rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #333;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            padding: 5px;
            font-size: 0.9rem;
        }

        .zone:hover {
            transform: scale(1.05);
            background-color: rgba(255, 255, 255, 0.3);
            z-index: 10;
        }

        .zone.urban { background-color: rgba(128, 128, 128, 0.7); }
        .zone.rural { background-color: rgba(34, 139, 34, 0.7); }
        .zone.mountain { background-color: rgba(139, 69, 19, 0.7); }
        .zone.coastal { background-color: rgba(30, 144, 255, 0.7); }
        .zone.rebel { background-color: rgba(220, 20, 60, 0.7); border: 2px solid red; }
        .zone.critical { background-color: rgba(255, 0, 0, 0.8); border: 2px solid darkred; }

        .stats-panel {
            background: rgba(0, 0, 0, 0.7);
            border-radius: 10px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .stat-bar {
            background: #333;
            border-radius: 5px;
            height: 25px;
            overflow: hidden;
            position: relative;
        }

        .stat-fill {
            height: 100%;
            border-radius: 5px;
            transition: width 0.5s;
        }

        .stability { background: linear-gradient(to right, #ff0000, #ffff00, #00ff00); }
        .economy { background: linear-gradient(to right, #ff8c00, #ffd700, #90ee90); }
        .support { background: linear-gradient(to right, #dc143c, #ffb6c1, #98fb98); }
        .military { background: linear-gradient(to right, #8b0000, #ff4500, #32cd32); }

        .stat-label {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            text-shadow: 1px 1px 2px black;
        }

        .resources {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 10px;
        }

        .resource {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px;
            border-radius: 5px;
            text-align: center;
        }

        .resource-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #ffcc00;
        }

        .actions-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 15px;
            margin-top: 20px;
            max-height: 400px;
            overflow-y: auto;
            padding: 10px;
        }

        .action-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s;
            border: 1px solid transparent;
        }

        .action-card:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: #ffcc00;
            transform: translateY(-5px);
        }

        .action-card h3 {
            color: #ffcc00;
            margin-bottom: 10px;
        }

        .action-cost {
            color: #ff6b6b;
            font-weight: bold;
            margin-top: 10px;
        }

        .events-log {
            background: rgba(0, 0, 0, 0.7);
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            height: 200px;
            overflow-y: auto;
        }

        .event {
            padding: 8px;
            margin-bottom: 8px;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.1);
        }

        .event.positive { border-left: 4px solid #4CAF50; }
        .event.negative { border-left: 4px solid #f44336; }
        .event.neutral { border-left: 4px solid #2196F3; }
        .event.critical { border-left: 4px solid #ff0000; background: rgba(255, 0, 0, 0.2); }

        .faction-bar {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
            background: rgba(255, 255, 255, 0.1);
            padding: 10px;
            border-radius: 5px;
        }

        .faction {
            text-align: center;
            flex: 1;
        }

        .faction-support {
            height: 10px;
            background: #333;
            border-radius: 5px;
            margin-top: 5px;
            overflow: hidden;
        }

        .faction-fill {
            height: 100%;
            border-radius: 5px;
        }

        .capitalists { background: #FFD700; }
        .communists { background: #FF4500; }
        .nationalists { background: #32CD32; }
        .religious { background: #8A2BE2; }
        .militarists { background: #DC143C; }
        .liberals { background: #1E90FF; }

        button {
            background: linear-gradient(to bottom, #ffcc00, #ff9900);
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            color: #333;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }

        button:hover {
            background: linear-gradient(to bottom, #ffd700, #ffaa00);
            transform: scale(1.05);
        }

        button:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
        }

        .tooltip {
            position: relative;
            display: inline-block;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 250px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 100;
            bottom: 125%;
            left: 50%;
            margin-left: -125px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.9rem;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        .controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 10px;
        }

        .regime-selector {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
        }

        .regime-btn {
            padding: 8px 15px;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid #555;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
        }

        .regime-btn.active {
            background: #ffcc00;
            color: #333;
            font-weight: bold;
        }

        .regime-btn:hover:not(.active) {
            background: rgba(255, 255, 255, 0.2);
        }

        .audio-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-top: 10px;
        }

        .audio-btn {
            padding: 5px 10px;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid #555;
            color: white;
            cursor: pointer;
        }

        .difficulty-selector {
            display: flex;
            gap: 10px;
            margin: 10px 0;
        }

        .difficulty-btn {
            padding: 8px 15px;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid #555;
            color: white;
            cursor: pointer;
        }

        .difficulty-btn.active {
            background: #ff6b6b;
            color: white;
            font-weight: bold;
        }

        .crisis-indicator {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255, 0, 0, 0.7);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-weight: bold;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { opacity: 0.7; }
            50% { opacity: 1; }
            100% { opacity: 0.7; }
        }

        .map-selector {
            display: flex;
            gap: 10px;
            margin: 10px 0;
        }

        .map-btn {
            padding: 8px 15px;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid #555;
            color: white;
            cursor: pointer;
        }

        .map-btn.active {
            background: #4CAF50;
            color: white;
            font-weight: bold;
        }

        .policy-tab {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
        }

        .policy-option {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
            padding: 5px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 3px;
        }

        .tab-container {
            display: flex;
            gap: 10px;
            margin: 15px 0;
        }

        .tab {
            padding: 8px 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px 5px 0 0;
            cursor: pointer;
        }

        .tab.active {
            background: #ffcc00;
            color: #333;
            font-weight: bold;
        }

        .tab-content {
            display: none;
            padding: 15px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 0 5px 5px 5px;
        }

        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <!-- Banana Background Container -->
    <div class="banana-container" aria-hidden="true"></div>

    <div class="container">
        <header>
            <div>
                <h1>üå¥ Tropical Revolution üå¥</h1>
                <p>Governo: <span id="government-type">Rep√∫blica Democr√°tica</span> | Ano: <span id="year">1985</span> | Dificuldade: <span id="difficulty">Normal</span></p>
            </div>
            <div class="audio-controls">
                <button class="audio-btn" id="music-toggle">üîä M√∫sica</button>
                <button class="audio-btn" id="sfx-toggle">üîä Efeitos</button>
                <select id="background-select">
                    <option value="default">Fundo Padr√£o</option>
                    <option value="beach">Praia Tropical</option>
                    <option value="jungle">Selva</option>
                    <option value="mountain">Montanhas</option>
                    <option value="city">Cidade</option>
                </select>
            </div>
        </header>

        <div class="controls">
            <div class="difficulty-selector">
                <button class="difficulty-btn active" data-difficulty="easy">F√°cil</button>
                <button class="difficulty-btn" data-difficulty="normal">Normal</button>
                <button class="difficulty-btn" data-difficulty="hard">Dif√≠cil</button>
                <button class="difficulty-btn" data-difficulty="expert">Especialista</button>
            </div>
            
            <div class="map-selector">
                <button class="map-btn active" data-map="tropical">Ilha Tropical</button>
                <button class="map-btn" data-map="archipelago">Arquip√©lago</button>
                <button class="map-btn" data-map="mainland">Continente</button>
            </div>
        </div>

        <div class="regime-selector">
            <button class="regime-btn" data-regime="democracy">Democracia</button>
            <button class="regime-btn" data-regime="laissez_faire">Laissez-Faire</button>
            <button class="regime-btn" data-regime="social_democracy">Social-Democracia</button>
            <button class="regime-btn" data-regime="populism">Populismo</button>
            <button class="regime-btn" data-regime="communism">Comunismo</button>
            <button class="regime-btn" data-regime="fascism">Fascismo</button>
            <button class="regime-btn" data-regime="theocracy">Teocracia</button>
            <button class="regime-btn" data-regime="military_junta">Junta Militar</button>
        </div>

        <div class="tab-container">
            <div class="tab active" data-tab="main">Principal</div>
            <div class="tab" data-tab="economy">Economia</div>
            <div class="tab" data-tab="military">Militar</div>
            <div class="tab" data-tab="diplomacy">Diplomacia</div>
        </div>

        <div class="tab-content active" id="main-tab">
            <div class="game-area">
                <div class="island-map" id="island-map">
                    <!-- Zonas ser√£o geradas via JavaScript -->
                </div>

                <div class="stats-panel">
                    <h2>Indicadores Nacionais</h2>
                    
                    <div class="tooltip">
                        Estabilidade:
                        <span class="tooltiptext">Qu√£o est√°vel √© o seu governo. Baixa estabilidade pode levar a revoltas.</span>
                    </div>
                    <div class="stat-bar">
                        <div class="stat-fill stability" id="stability-bar" style="width: 65%;"></div>
                        <div class="stat-label" id="stability-text">65%</div>
                    </div>

                    <div class="tooltip">
                        Economia:
                        <span class="tooltiptext">Sa√∫de da sua economia. Afeta seus recursos e capacidade de investimento.</span>
                    </div>
                    <div class="stat-bar">
                        <div class="stat-fill economy" id="economy-bar" style="width: 45%;"></div>
                        <div class="stat-label" id="economy-text">45%</div>
                    </div>

                    <div class="tooltip">
                        Apoio Popular:
                        <span class="tooltiptext">Quanto o povo apoia seu governo. Baixo apoio reduz estabilidade.</span>
                    </div>
                    <div class="stat-bar">
                        <div class="stat-fill support" id="support-bar" style="width: 70%;"></div>
                        <div class="stat-label" id="support-text">70%</div>
                    </div>

                    <div class="tooltip">
                        Controle Militar:
                        <span class="tooltiptext">Quanto do territ√≥rio est√° sob controle governamental.</span>
                    </div>
                    <div class="stat-bar">
                        <div class="stat-fill military" id="military-bar" style="width: 85%;"></div>
                        <div class="stat-label" id="military-text">85%</div>
                    </div>

                    <div class="resources">
                        <div class="resource">
                            <div>üí∞ Or√ßamento</div>
                            <div class="resource-value" id="budget">$15,000</div>
                        </div>
                        <div class="resource">
                            <div>üõ¢Ô∏è Recursos</div>
                            <div class="resource-value" id="resources">2,500</div>
                        </div>
                        <div class="resource">
                            <div>üë• Popula√ß√£o</div>
                            <div class="resource-value" id="population">125K</div>
                        </div>
                        <div class="resource">
                            <div>‚ö° Energia</div>
                            <div class="resource-value" id="energy">1,200</div>
                        </div>
                    </div>

                    <h3>Fac√ß√µes Pol√≠ticas</h3>
                    <div class="faction-bar">
                        <div class="faction">
                            <div>Capitalistas</div>
                            <div class="faction-support">
                                <div class="faction-fill capitalists" style="width: 40%;"></div>
                            </div>
                            <div>40%</div>
                        </div>
                        <div class="faction">
                            <div>Comunistas</div>
                            <div class="faction-support">
                                <div class="faction-fill communists" style="width: 25%;"></div>
                            </div>
                            <div>25%</div>
                        </div>
                        <div class="faction">
                            <div>Nacionalistas</div>
                            <div class="faction-support">
                                <div class="faction-fill nationalists" style="width: 60%;"></div>
                            </div>
                            <div>60%</div>
                        </div>
                        <div class="faction">
                            <div>Religiosos</div>
                            <div class="faction-support">
                                <div class="faction-fill religious" style="width: 35%;"></div>
                            </div>
                            <div>35%</div>
                        </div>
                        <div class="faction">
                            <div>Militares</div>
                            <div class="faction-support">
                                <div class="faction-fill militarists" style="width: 55%;"></div>
                            </div>
                            <div>55%</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="actions-panel" id="actions-panel">
                <!-- A√ß√µes ser√£o geradas via JavaScript -->
            </div>

            <div class="events-log" id="events-log">
                <h3>üì∞ Eventos e Not√≠cias</h3>
                <!-- Eventos ser√£o gerados via JavaScript -->
            </div>

            <div style="text-align: center; margin-top: 20px;">
                <button id="next-turn">Pr√≥ximo Turno</button>
            </div>
        </div>

        <div class="tab-content" id="economy-tab">
            <h2>Pol√≠tica Econ√¥mica</h2>
            <div class="policy-tab">
                <h3>Impostos</h3>
                <div class="policy-option">
                    <span>Imposto de Renda:</span>
                    <select id="income-tax">
                        <option value="0">0% (Sem imposto)</option>
                        <option value="10">10% (Baixo)</option>
                        <option value="20" selected>20% (Moderado)</option>
                        <option value="30">30% (Alto)</option>
                        <option value="40">40% (Muito Alto)</option>
                    </select>
                </div>
                <div class="policy-option">
                    <span>Imposto Corporativo:</span>
                    <select id="corporate-tax">
                        <option value="0">0% (Laissez-faire)</option>
                        <option value="15">15% (Baixo)</option>
                        <option value="25" selected>25% (Moderado)</option>
                        <option value="35">35% (Alto)</option>
                        <option value="45">45% (Muito Alto)</option>
                    </select>
                </div>
                
                <h3>Regula√ß√µes</h3>
                <div class="policy-option">
                    <span>Regula√ß√£o Trabalhista:</span>
                    <select id="labor-regulation">
                        <option value="0">M√≠nima</option>
                        <option value="1" selected>Moderada</option>
                        <option value="2">Forte</option>
                    </select>
                </div>
                <div class="policy-option">
                    <span>Regula√ß√£o Ambiental:</span>
                    <select id="environment-regulation">
                        <option value="0">M√≠nima</option>
                        <option value="1" selected>Moderada</option>
                        <option value="2">Forte</option>
                    </select>
                </div>
                
                <button id="apply-economic-policy">Aplicar Pol√≠tica Econ√¥mica</button>
            </div>
        </div>

        <div class="tab-content" id="military-tab">
            <h2>Capacidades Militares</h2>
            <div class="policy-tab">
                <h3>For√ßas Armadas</h3>
                <div class="policy-option">
                    <span>Ex√©rcito: <span id="army-size">5,000</span> tropas</span>
                    <button id="recruit-army">Recrutar (+1,000 tropas - $2,000)</button>
                </div>
                <div class="policy-option">
                    <span>Marinha: <span id="navy-size">3</span> navios</span>
                    <button id="build-navy">Construir (+1 navio - $5,000)</button>
                </div>
                <div class="policy-option">
                    <span>For√ßa A√©rea: <span id="airforce-size">10</span> aeronaves</span>
                    <button id="build-airforce">Adquirir (+2 aeronaves - $3,000)</button>
                </div>
                
                <h3>Opera√ß√µes</h3>
                <div class="policy-option">
                    <span>Contra-Insurg√™ncia:</span>
                    <button id="counter-insurgency">Lan√ßar Opera√ß√£o ($1,000)</button>
                </div>
                <div class="policy-option">
                    <span>Patrulha de Fronteira:</span>
                    <button id="border-patrol">Intensificar ($500)</button>
                </div>
            </div>
        </div>

        <div class="tab-content" id="diplomacy-tab">
            <h2>Rela√ß√µes Internacionais</h2>
            <div class="policy-tab">
                <h3>Alian√ßas</h3>
                <div class="policy-option">
                    <span>OCIDENTE (EUA/Europa): <span id="west-relation">50</span>/100</span>
                    <button id="improve-west">Melhorar Rela√ß√µes ($1,000)</button>
                </div>
                <div class="policy-option">
                    <span>ORIENTE (R√∫ssia/China): <span id="east-relation">40</span>/100</span>
                    <button id="improve-east">Melhorar Rela√ß√µes ($1,000)</button>
                </div>
                <div class="policy-option">
                    <span>Vizinhos Regionais: <span id="neighbors-relation">60</span>/100</span>
                    <button id="improve-neighbors">Melhorar Rela√ß√µes ($500)</button>
                </div>
                
                <h3>Acordos Internacionais</h3>
                <div class="policy-option">
                    <span>Organiza√ß√£o Mundial do Com√©rcio:</span>
                    <button id="join-wto">Solicitar Ades√£o ($2,000)</button>
                </div>
                <div class="policy-option">
                    <span>Tratado de Defesa M√∫tua:</span>
                    <button id="defense-treaty">Negociar ($1,500)</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Sistema de √Åudio -->
    <audio id="background-music" loop>
        <source src="https://upload.wikimedia.org/wikipedia/commons/2/24/Tico_tico_no_fub%C3%A1.ogg" type="audio/ogg">
        <source src="https://www.soundjay.com/misc/sounds/fail-buzzer-02.wav" type="audio/wav">
    </audio>

    <audio id="sfx-click">
        <source src="https://www.soundjay.com/buttons/sounds/button-09.mp3" type="audio/mpeg">
    </audio>

    <script>
        // ========== SISTEMA DE BACKGROUND E √ÅUDIO ==========

        // Fun√ß√µes para criar o fundo animado com bananas
        function createBananaElements(count = 25) {
            const container = document.querySelector('.banana-container');
            if (!container) return;
            container.innerHTML = '';

            for (let i = 0; i < count; i++) {
                const span = document.createElement('span');
                span.className = 'banana';
                span.textContent = 'üçå';

                const x = Math.random() * 100;
                const y = Math.random() * 100;
                const size = 14 + Math.random() * 26;
                const rotate = (Math.random() * 40 - 20) + 'deg';
                const opacity = 0.5 + Math.random() * 0.6;

                span.style.left = x + 'vw';
                span.style.top = y + 'vh';
                span.style.fontSize = size + 'px';
                span.style.opacity = opacity;
                span.style.transform = `rotate(${rotate})`;
                span.style.setProperty('--r', rotate);

                container.appendChild(span);
            }
        }

        function triggerRandomBananaGlow() {
            const bananas = Array.from(document.querySelectorAll('.banana-container .banana'));
            if (!bananas.length) return;

            const toGlow = Math.max(1, Math.floor(Math.random() * 3));
            for (let i = 0; i < toGlow; i++) {
                const idx = Math.floor(Math.random() * bananas.length);
                const el = bananas[idx];
                if (!el) continue;

                el.classList.add('banana-glow');
                if (Math.random() < 0.35) el.classList.add('strong');

                const hold = 900 + Math.random() * 1600;
                el.style.opacity = 1;
                setTimeout(() => {
                    el.classList.remove('banana-glow');
                    el.classList.remove('strong');
                    el.style.opacity = 0.8 + Math.random() * 0.2;
                }, hold);
            }
        }

        // Sistema de √°udio
        const AUDIO_MUTED_KEY = 'tropical_revolution_audio_muted';
        let audioCtx = null;
        let audioAllowed = true;

        function ensureAudioContext() {
            if (audioCtx) return audioCtx;
            try {
                const Ctx = window.AudioContext || window.webkitAudioContext;
                audioCtx = new Ctx();
            } catch (e) {
                audioAllowed = false;
                return null;
            }
            return audioCtx;
        }

        function isMuted() {
            return localStorage.getItem(AUDIO_MUTED_KEY) === '1';
        }

        function setMuted(val) {
            localStorage.setItem(AUDIO_MUTED_KEY, val ? '1' : '0');
            updateMuteIcon();
            updateBackgroundMusic();
        }

        function toggleMusic() {
            setMuted(!isMuted());
        }

        function toggleSFX() {
            gameState.audio.sfx = !gameState.audio.sfx;
            const btn = document.getElementById('sfx-toggle');
            btn.textContent = gameState.audio.sfx ? "üîä Efeitos" : "üîá Efeitos";
        }

        function updateMuteIcon() {
            const icon = document.getElementById('music-toggle');
            if (!icon) return;
            if (isMuted()) {
                icon.textContent = 'üîá M√∫sica';
            } else {
                icon.textContent = 'üîä M√∫sica';
            }
        }

        function updateBackgroundMusic() {
            const audio = document.getElementById('background-music');
            if (!audio) return;
            if (isMuted()) {
                try { audio.pause(); } catch (e) {}
                audio.muted = true;
            } else {
                audio.muted = false;
                audio.play().catch(() => {});
            }
        }

        function initBackgroundMusic() {
            const audio = document.getElementById('background-music');
            if (!audio) return;

            updateBackgroundMusic();

            ['click','touchstart','keydown'].forEach(evt => {
                window.addEventListener(evt, function _startBgOnce() {
                    audio.play().catch(() => {});
                    window.removeEventListener(evt, _startBgOnce);
                }, { once: true });
            });
        }

        function playSFX(type) {
            if (!gameState.audio.sfx) return;
            
            const audio = new Audio();
            switch(type) {
                case 'click':
                    audio.src = "https://www.soundjay.com/buttons/sounds/button-09.mp3";
                    break;
                case 'next_turn':
                    audio.src = "https://www.soundjay.com/mechanical/sounds/camera-shutter-click-01.wav";
                    break;
                case 'event':
                    audio.src = "https://www.soundjay.com/misc/sounds/bell-ringing-05.wav";
                    break;
                case 'crisis':
                    audio.src = "https://www.soundjay.com/misc/sounds/fail-buzzer-02.wav";
                    break;
                case 'error':
                    audio.src = "https://www.soundjay.com/buttons/sounds/button-10.mp3";
                    break;
                case 'military':
                    audio.src = "https://www.soundjay.com/military/sounds/tank-cannon-1.mp3";
                    break;
                case 'diplomacy':
                    audio.src = "https://www.soundjay.com/misc/sounds/small-crowd-applause-01.wav";
                    break;
                case 'policy':
                    audio.src = "https://www.soundjay.com/mechanical/sounds/camera-shutter-click-03.wav";
                    break;
            }
            audio.play().catch(e => console.log("SFX n√£o p√¥de ser reproduzido"));
        }

        function changeBackground() {
            const select = document.getElementById('background-select');
            const body = document.body;
            
            switch(select.value) {
                case 'beach':
                    body.style.background = 'linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d)';
                    break;
                case 'jungle':
                    body.style.background = 'linear-gradient(135deg, #1b4332, #2d6a4f, #40916c)';
                    break;
                case 'mountain':
                    body.style.background = 'linear-gradient(135deg, #3a5a40, #588157, #a3b18a)';
                    break;
                case 'city':
                    body.style.background = 'linear-gradient(135deg, #1e3a5f, #4a4e69, #9a8c98)';
                    break;
                default:
                    body.style.background = 'linear-gradient(135deg, #b8e9c3 0%, #00B4D8 100%)';
            }
        }

        // ========== INICIALIZA√á√ÉO DO SISTEMA VISUAL/AUDIO ==========

        function initVisualAudioSystem() {
            createBananaElements(25);
            
            setInterval(() => {
                triggerRandomBananaGlow();
            }, 1500 + Math.random() * 3000);
            
            initBackgroundMusic();
            updateMuteIcon();
            
            document.getElementById('music-toggle').addEventListener('click', toggleMusic);
            document.getElementById('sfx-toggle').addEventListener('click', toggleSFX);
            document.getElementById('background-select').addEventListener('change', changeBackground);
            
            ['click','touchstart','keydown'].forEach(evt => {
                window.addEventListener(evt, function _initAudioOnce() {
                    ensureAudioContext();
                    window.removeEventListener(evt, _initAudioOnce);
                }, { once: true });
            });
        }

        // ========== ESTADO DO JOGO ==========

        const gameState = {
            year: 1985,
            stability: 65,
            economy: 45,
            support: 70,
            military: 85,
            budget: 15000,
            resources: 2500,
            population: 125000,
            energy: 1200,
            government: "Rep√∫blica Democr√°tica",
            regime: "democracy",
            difficulty: "normal",
            currentMap: "tropical",
            inflation: 2.5,
            gdp: 50000,
            unemployment: 8,
            education: 60,
            healthcare: 55,
            infrastructure: 50,
            corruption: 25,
            foreignDebt: 10000,
            army: 5000,
            navy: 3,
            airforce: 10,
            rebelActivity: 15,
            crisis: null,
            relations: {
                west: 50,
                east: 40,
                neighbors: 60
            },
            policies: {
                incomeTax: 20,
                corporateTax: 25,
                laborRegulation: 1,
                environmentRegulation: 1
            },
            factions: {
                capitalists: 40,
                communists: 25,
                nationalists: 60,
                religious: 35,
                militarists: 55,
                liberals: 30
            },
            zones: [],
            events: [],
            actions: [],
            audio: {
                music: true,
                sfx: true
            }
        };

        // ========== SISTEMA DE REGIMES ==========

        const regimes = {
            democracy: {
                name: "Democracia",
                stability: 5,
                economy: 0,
                support: 10,
                military: -5,
                factionEffects: { capitalists: 5, liberals: 10, militarists: -5 }
            },
            laissez_faire: {
                name: "Laissez-Faire",
                stability: -10,
                economy: 15,
                support: -15,
                military: -10,
                factionEffects: { capitalists: 20, communists: -20, liberals: 5 }
            },
            social_democracy: {
                name: "Social-Democracia",
                stability: 10,
                economy: 5,
                support: 15,
                military: 0,
                factionEffects: { capitalists: -5, communists: 10, liberals: 15 }
            },
            populism: {
                name: "Populismo",
                stability: -5,
                economy: -10,
                support: 20,
                military: 0,
                factionEffects: { nationalists: 15, religious: 10, capitalists: -10 }
            },
            communism: {
                name: "Comunismo",
                stability: -15,
                economy: -20,
                support: -10,
                military: 10,
                factionEffects: { communists: 25, capitalists: -25, militarists: 10 }
            },
            fascism: {
                name: "Fascismo",
                stability: -20,
                economy: -15,
                support: -20,
                military: 20,
                factionEffects: { militarists: 25, nationalists: 20, liberals: -25 }
            },
            theocracy: {
                name: "Teocracia",
                stability: -10,
                economy: -10,
                support: 5,
                military: 5,
                factionEffects: { religious: 30, liberals: -20, communists: -15 }
            },
            military_junta: {
                name: "Junta Militar",
                stability: -25,
                economy: -15,
                support: -25,
                military: 25,
                factionEffects: { militarists: 30, capitalists: -10, liberals: -20 }
            }
        };

        // ========== SISTEMA DE CRISES ==========

        const crises = [
            {
                id: "economic_crisis",
                name: "Crise Econ√¥mica",
                probability: 0.1,
                trigger: (state) => state.economy < 30 || state.inflation > 15,
                effect: { economy: -15, stability: -10, support: -15 },
                duration: 3
            },
            {
                id: "rebellion",
                name: "Rebeli√£o Armada",
                probability: 0.08,
                trigger: (state) => state.support < 30 && state.military < 60,
                effect: { military: -20, stability: -25, budget: -2000 },
                duration: 5
            },
            {
                id: "natural_disaster",
                name: "Desastre Natural",
                probability: 0.05,
                trigger: () => Math.random() < 0.1,
                effect: { infrastructure: -20, budget: -3000, support: -10 },
                duration: 2
            },
            {
                id: "corruption_scandal",
                name: "Esc√¢ndalo de Corrup√ß√£o",
                probability: 0.07,
                trigger: (state) => state.corruption > 40,
                effect: { support: -20, stability: -15, relations: { west: -10, east: -10 } },
                duration: 4
            }
        ];

        // ========== FUN√á√ïES PRINCIPAIS DO JOGO ==========

        function setupEventListeners() {
            // Regimes
            document.querySelectorAll('.regime-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.regime-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    changeRegime(btn.dataset.regime);
                });
            });

            // Dificuldade
            document.querySelectorAll('.difficulty-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.difficulty-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    gameState.difficulty = btn.dataset.difficulty;
                    document.getElementById('difficulty').textContent = 
                        btn.dataset.difficulty === 'easy' ? 'F√°cil' :
                        btn.dataset.difficulty === 'normal' ? 'Normal' :
                        btn.dataset.difficulty === 'hard' ? 'Dif√≠cil' : 'Especialista';
                    updateUI();
                });
            });

            // Mapas
            document.querySelectorAll('.map-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.map-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    gameState.currentMap = btn.dataset.map;
                    generateZones();
                });
            });

            // Tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    tab.classList.add('active');
                    document.getElementById(`${tab.dataset.tab}-tab`).classList.add('active');
                });
            });

            // Pr√≥ximo turno
            document.getElementById('next-turn').addEventListener('click', nextTurn);

            // Pol√≠ticas econ√¥micas
            document.getElementById('apply-economic-policy').addEventListener('click', applyEconomicPolicy);

            // Militar
            document.getElementById('recruit-army').addEventListener('click', () => recruitArmy());
            document.getElementById('build-navy').addEventListener('click', () => buildNavy());
            document.getElementById('build-airforce').addEventListener('click', () => buildAirforce());
            document.getElementById('counter-insurgency').addEventListener('click', () => counterInsurgency());
            document.getElementById('border-patrol').addEventListener('click', () => borderPatrol());

            // Diplomacia
            document.getElementById('improve-west').addEventListener('click', () => improveRelations('west'));
            document.getElementById('improve-east').addEventListener('click', () => improveRelations('east'));
            document.getElementById('improve-neighbors').addEventListener('click', () => improveRelations('neighbors'));
            document.getElementById('join-wto').addEventListener('click', joinWTO);
            document.getElementById('defense-treaty').addEventListener('click', defenseTreaty);
        }

        function generateZones() {
            const map = document.getElementById('island-map');
            map.innerHTML = '';
            
            let zoneTypes = [];
            
            switch(gameState.currentMap) {
                case 'tropical':
                    zoneTypes = [
                        { type: 'urban', name: 'Cidade Capital', count: 1 },
                        { type: 'urban', name: 'Cidade Portu√°ria', count: 1 },
                        { type: 'rural', name: 'Zona Agr√≠cola', count: 3 },
                        { type: 'mountain', name: 'Regi√£o Montanhosa', count: 2 },
                        { type: 'coastal', name: '√Årea Costeira', count: 2 }
                    ];
                    break;
                case 'archipelago':
                    zoneTypes = [
                        { type: 'urban', name: 'Ilha Principal', count: 1 },
                        { type: 'coastal', name: 'Ilha Tur√≠stica', count: 2 },
                        { type: 'rural', name: 'Ilha Agr√≠cola', count: 2 },
                        { type: 'mountain', name: 'Ilha Vulc√¢nica', count: 1 },
                        { type: 'coastal', name: 'Atol', count: 2 }
                    ];
                    break;
                case 'mainland':
                    zoneTypes = [
                        { type: 'urban', name: 'Metr√≥pole', count: 2 },
                        { type: 'urban', name: 'Cidade Industrial', count: 1 },
                        { type: 'rural', name: 'Zona Agr√≠cola', count: 4 },
                        { type: 'mountain', name: 'Regi√£o Montanhosa', count: 3 },
                        { type: 'coastal', name: 'Porto Mar√≠timo', count: 2 }
                    ];
                    break;
            }

            let zones = [];
            zoneTypes.forEach(zoneType => {
                for (let i = 0; i < zoneType.count; i++) {
                    const rebel = Math.random() < 0.2;
                    const critical = rebel && Math.random() < 0.3;
                    
                    zones.push({
                        type: zoneType.type,
                        name: `${zoneType.name} ${i + 1}`,
                        x: Math.random() * 70 + 5,
                        y: Math.random() * 70 + 5,
                        width: 15 + Math.random() * 20,
                        height: 12 + Math.random() * 15,
                        stability: 50 + Math.random() * 40,
                        development: Math.random() * 100,
                        rebel: rebel,
                        critical: critical
                    });
                }
            });

            gameState.zones = zones;

            // Renderizar zonas
            zones.forEach(zone => {
                const zoneElement = document.createElement('div');
                let zoneClass = `zone ${zone.type}`;
                if (zone.rebel) zoneClass += ' rebel';
                if (zone.critical) zoneClass += ' critical';
                
                zoneElement.className = zoneClass;
                zoneElement.style.left = `${zone.x}%`;
                zoneElement.style.top = `${zone.y}%`;
                zoneElement.style.width = `${zone.width}%`;
                zoneElement.style.height = `${zone.height}%`;
                zoneElement.innerHTML = zone.name;
                
                let title = `Estabilidade: ${Math.round(zone.stability)}% | Desenvolvimento: ${Math.round(zone.development)}%`;
                if (zone.rebel) title += " | REBELDES ATIVOS";
                if (zone.critical) title += " | CR√çTICO!";
                
                zoneElement.title = title;
                
                zoneElement.addEventListener('click', () => {
                    let message = `${zone.name}\nTipo: ${zone.type}\nEstabilidade: ${Math.round(zone.stability)}%\nDesenvolvimento: ${Math.round(zone.development)}%`;
                    if (zone.rebel) message += "\n‚ö†Ô∏è Zona com atividade rebelde!";
                    if (zone.critical) message += "\nüö® CRISE: Rebeldia cr√≠tica nesta regi√£o!";
                    alert(message);
                });
                
                map.appendChild(zoneElement);
            });

            // Adicionar indicador de crise se houver zonas cr√≠ticas
            const criticalZones = zones.filter(z => z.critical);
            if (criticalZones.length > 0) {
                const crisisIndicator = document.createElement('div');
                crisisIndicator.className = 'crisis-indicator';
                crisisIndicator.textContent = `üö® ${criticalZones.length} CRISE(S) ATIVA(S)`;
                map.appendChild(crisisIndicator);
            }
        }

        function updateUI() {
            document.getElementById('year').textContent = gameState.year;
            document.getElementById('government-type').textContent = gameState.government;
            
            // Atualizar barras de status
            document.getElementById('stability-bar').style.width = `${gameState.stability}%`;
            document.getElementById('stability-text').textContent = `${gameState.stability}%`;
            
            document.getElementById('economy-bar').style.width = `${gameState.economy}%`;
            document.getElementById('economy-text').textContent = `${gameState.economy}%`;
            
            document.getElementById('support-bar').style.width = `${gameState.support}%`;
            document.getElementById('support-text').textContent = `${gameState.support}%`;
            
            document.getElementById('military-bar').style.width = `${gameState.military}%`;
            document.getElementById('military-text').textContent = `${gameState.military}%`;
            
            // Atualizar recursos
            document.getElementById('budget').textContent = `$${gameState.budget.toLocaleString()}`;
            document.getElementById('resources').textContent = gameState.resources.toLocaleString();
            document.getElementById('population').textContent = `${(gameState.population / 1000).toFixed(0)}K`;
            document.getElementById('energy').textContent = gameState.energy.toLocaleString();
            
            // Atualizar militar
            document.getElementById('army-size').textContent = gameState.army.toLocaleString();
            document.getElementById('navy-size').textContent = gameState.navy;
            document.getElementById('airforce-size').textContent = gameState.airforce;
            
            // Atualizar diplomacia
            document.getElementById('west-relation').textContent = gameState.relations.west;
            document.getElementById('east-relation').textContent = gameState.relations.east;
            document.getElementById('neighbors-relation').textContent = gameState.relations.neighbors;
            
            // Atualizar fac√ß√µes
            updateFactions();
        }

        function updateFactions() {
            Object.keys(gameState.factions).forEach(faction => {
                const fill = document.querySelector(`.faction-fill.${faction}`);
                if (fill) {
                    fill.style.width = `${gameState.factions[faction]}%`;
                }
                const value = document.querySelector(`.faction:has(.${faction}) div:last-child`);
                if (value) {
                    value.textContent = `${gameState.factions[faction]}%`;
                }
            });
        }

        function updateActions() {
            const baseActions = [
                {
                    id: 1,
                    name: "Construir Escola",
                    description: "Melhora educa√ß√£o e apoio popular",
                    cost: 2000,
                    effect: { support: 5, education: 10, stability: 3 },
                    type: "development",
                    available: true
                },
                {
                    id: 2,
                    name: "Investir em Turismo",
                    description: "Aumenta economia mas pode causar infla√ß√£o",
                    cost: 3000,
                    effect: { economy: 10, stability: -2, inflation: 1 },
                    type: "economic",
                    available: true
                },
                {
                    id: 3,
                    name: "Opera√ß√£o Militar",
                    description: "Aumenta controle militar mas reduz apoio popular",
                    cost: 5000,
                    effect: { military: 10, support: -5, rebelActivity: -5 },
                    type: "military",
                    available: true
                },
                {
                    id: 4,
                    name: "Programa de Bem-Estar",
                    description: "Aumenta apoio popular mas custa recursos",
                    cost: 4000,
                    effect: { support: 8, budget: -1000, healthcare: 10 },
                    type: "social",
                    available: true
                },
                {
                    id: 5,
                    name: "Explora√ß√£o de Recursos",
                    description: "Aumenta recursos mas pode danificar o meio ambiente",
                    cost: 2500,
                    effect: { resources: 500, support: -3, environment: -5 },
                    type: "economic",
                    available: true
                },
                {
                    id: 6,
                    name: "Alian√ßa Estrangeira",
                    description: "Ganha apoio internacional mas perde soberania",
                    cost: 1500,
                    effect: { stability: 5, economy: 5, military: -5 },
                    type: "diplomatic",
                    available: true
                },
                {
                    id: 7,
                    name: "Campanha de Propaganda",
                    description: "Aumenta apoio popular temporariamente",
                    cost: 2000,
                    effect: { support: 15, stability: 5, budget: -500 },
                    type: "political",
                    available: true
                },
                {
                    id: 8,
                    name: "Infraestrutura P√∫blica",
                    description: "Melhora infraestrutura e economia a longo prazo",
                    cost: 6000,
                    effect: { infrastructure: 15, economy: 8, stability: 5 },
                    type: "development",
                    available: true
                }
            ];

            const regimeActions = {
                laissez_faire: [
                    {
                        id: 9,
                        name: "Desregulamenta√ß√£o",
                        description: "Aumenta crescimento econ√¥mico mas aumenta desigualdade",
                        cost: 1000,
                        effect: { economy: 15, support: -10, stability: -5 },
                        type: "economic",
                        available: true
                    }
                ],
                communism: [
                    {
                        id: 10,
                        name: "Nacionaliza√ß√£o",
                        description: "Estataliza ind√∫strias chave",
                        cost: 4000,
                        effect: { resources: 1000, capitalists: -20, communists: 15 },
                        type: "economic",
                        available: true
                    }
                ],
                populism: [
                    {
                        id: 11,
                        name: "Subs√≠dios Populares",
                        description: "Aumenta apoio no curto prazo, mas prejudica economia",
                        cost: 3000,
                        effect: { support: 20, economy: -10, budget: -2000 },
                        type: "social",
                        available: true
                    }
                ]
            };

            gameState.actions = baseActions;
            if (regimeActions[gameState.regime]) {
                gameState.actions = gameState.actions.concat(regimeActions[gameState.regime]);
            }

            renderActions();
        }

        function renderActions() {
            const actionsPanel = document.getElementById('actions-panel');
            actionsPanel.innerHTML = '';
            
            gameState.actions.forEach(action => {
                const canAfford = gameState.budget >= action.cost;
                const actionElement = document.createElement('div');
                actionElement.className = 'action-card';
                actionElement.innerHTML = `
                    <h3>${action.name}</h3>
                    <p>${action.description}</p>
                    <div class="action-cost">Custo: $${action.cost.toLocaleString()}</div>
                    <button ${!canAfford ? 'disabled' : ''}>Executar</button>
                `;
                
                actionElement.querySelector('button').addEventListener('click', () => {
                    executeAction(action);
                });
                
                actionsPanel.appendChild(actionElement);
            });
        }

        function executeAction(action) {
            if (gameState.budget < action.cost) {
                logEvent(`Or√ßamento insuficiente para ${action.name.toLowerCase()}!`, "negative");
                playSFX('error');
                return;
            }
            
            gameState.budget -= action.cost;
            
            // Aplicar efeitos
            Object.keys(action.effect).forEach(stat => {
                if (stat === 'budget') {
                    gameState.budget += action.effect[stat];
                } else if (stat === 'inflation') {
                    gameState.inflation = Math.max(0, gameState.inflation + action.effect[stat]);
                } else if (stat in gameState.factions) {
                    gameState.factions[stat] = Math.max(0, Math.min(100, gameState.factions[stat] + action.effect[stat]));
                } else if (stat in gameState) {
                    gameState[stat] = Math.max(0, Math.min(100, gameState[stat] + action.effect[stat]));
                }
            });
            
            logEvent(`A√ß√£o executada: ${action.name}`, "positive");
            playSFX('click');
            updateUI();
            checkGameState();
        }

        function changeRegime(regime) {
            const oldRegime = gameState.regime;
            gameState.regime = regime;
            gameState.government = regimes[regime].name;
            
            // Aplicar efeitos do novo regime
            const effects = regimes[regime];
            gameState.stability = Math.max(0, Math.min(100, gameState.stability + effects.stability));
            gameState.economy = Math.max(0, Math.min(100, gameState.economy + effects.economy));
            gameState.support = Math.max(0, Math.min(100, gameState.support + effects.support));
            gameState.military = Math.max(0, Math.min(100, gameState.military + effects.military));
            
            // Aplicar efeitos nas fac√ß√µes
            Object.keys(effects.factionEffects).forEach(faction => {
                gameState.factions[faction] = Math.max(0, Math.min(100, 
                    gameState.factions[faction] + effects.factionEffects[faction]));
            });
            
            logEvent(`Regime alterado para: ${regimes[regime].name}`, "neutral");
            updateActions();
            updateUI();
        }

        function nextTurn() {
            gameState.year++;
            
            // Efeitos base do turno
            const difficultyMultiplier = {
                easy: 1.2,
                normal: 1.0,
                hard: 0.8,
                expert: 0.6
            }[gameState.difficulty];
            
            // Economia realista baseada no regime
            let economicGrowth = 0;
            switch(gameState.regime) {
                case 'laissez_faire':
                    economicGrowth = 8 + Math.random() * 4;
                    gameState.inflation += 0.5;
                    break;
                case 'democracy':
                    economicGrowth = 4 + Math.random() * 3;
                    break;
                case 'social_democracy':
                    economicGrowth = 3 + Math.random() * 2;
                    break;
                case 'populism':
                    economicGrowth = 6 + Math.random() * 4;
                    gameState.inflation += 1.5;
                    if (gameState.year > 1987) economicGrowth = -2 + Math.random() * 2;
                    break;
                case 'communism':
                    economicGrowth = 2 + Math.random() * 2;
                    gameState.resources += 300;
                    break;
                case 'fascism':
                    economicGrowth = 5 + Math.random() * 3;
                    gameState.military += 2;
                    break;
                default:
                    economicGrowth = 3 + Math.random() * 2;
            }
            
            // Aplicar crescimento econ√¥mico
            gameState.economy = Math.max(0, Math.min(100, 
                gameState.economy + economicGrowth * difficultyMultiplier));
            
            // Efeitos de infla√ß√£o
            if (gameState.inflation > 10) {
                gameState.support -= 2;
                gameState.stability -= 1;
            }
            
            // Atualizar or√ßamento baseado na economia
            const taxRevenue = gameState.population * gameState.policies.incomeTax / 100 * 0.1;
            const corporateRevenue = gameState.economy * gameState.policies.corporateTax * 10;
            gameState.budget += Math.floor((taxRevenue + corporateRevenue) * difficultyMultiplier);
            
            // Pequenas varia√ß√µes aleat√≥rias
            gameState.stability += Math.floor(Math.random() * 6) - 3;
            gameState.support += Math.floor(Math.random() * 5) - 2;
            
            // Atividade rebelde
            if (gameState.support < 40) {
                gameState.rebelActivity += 5;
            }
            if (gameState.military > 70) {
                gameState.rebelActivity -= 3;
            }
            
            // Atualizar zonas com atividade rebelde
            gameState.zones.forEach(zone => {
                if (zone.rebel) {
                    zone.stability -= 5 + Math.random() * 10;
                    if (zone.stability < 20 && !zone.critical) {
                        zone.critical = true;
                        logEvent(`CRISE: A regi√£o ${zone.name} est√° em rebeli√£o aberta!`, "critical");
                    }
                }
            });
            
            // Verificar crises
            checkCrises();
            
            // Eventos aleat√≥rios
            if (Math.random() < 0.4) {
                triggerRandomEvent();
            }
            
            logEvent("Novo turno iniciado. Or√ßamento e indicadores atualizados.", "neutral");
            updateUI();
            checkGameState();
            playSFX('next_turn');
        }

        function checkCrises() {
            crises.forEach(crisis => {
                if (!gameState.crisis && Math.random() < crisis.probability && crisis.trigger(gameState)) {
                    gameState.crisis = { ...crisis, turnsRemaining: crisis.duration };
                    logEvent(`CRISE: ${crisis.name} eclodiu!`, "critical");
                    
                    // Aplicar efeitos da crise
                    Object.keys(crisis.effect).forEach(stat => {
                        if (stat === 'relations') {
                            Object.keys(crisis.effect[stat]).forEach(relation => {
                                gameState.relations[relation] += crisis.effect[stat][relation];
                            });
                        } else {
                            gameState[stat] = Math.max(0, Math.min(100, gameState[stat] + crisis.effect[stat]));
                        }
                    });
                }
            });
            
            // Reduzir dura√ß√£o da crise ativa
            if (gameState.crisis) {
                gameState.crisis.turnsRemaining--;
                if (gameState.crisis.turnsRemaining <= 0) {
                    logEvent(`A crise ${gameState.crisis.name} foi resolvida.`, "positive");
                    gameState.crisis = null;
                }
            }
        }

        function triggerRandomEvent() {
            const events = [
                {
                    message: "Descoberta de reservas de petr√≥leo! A economia recebe um impulso.",
                    type: "positive",
                    effect: { economy: 10, budget: 2000, resources: 500 }
                },
                {
                    message: "Protestos em massa contra o governo! Apoio popular cai.",
                    type: "negative",
                    effect: { support: -15, stability: -10 }
                },
                {
                    message: "Tempestade tropical causa danos √† infraestrutura!",
                    type: "negative",
                    effect: { infrastructure: -20, budget: -1500, energy: -200 }
                },
                {
                    message: "Aumento no turismo internacional! Receitas sobem.",
                    type: "positive",
                    effect: { economy: 12, budget: 2500 }
                },
                {
                    message: "Esc√¢ndalo de corrup√ß√£o abala o governo!",
                    type: "negative",
                    effect: { support: -20, stability: -15, corruption: 10 }
                },
                {
                    message: "Revolu√ß√£o tecnol√≥gica impulsiona a produtividade!",
                    type: "positive",
                    effect: { economy: 15, education: 10 }
                },
                {
                    message: "Golpe de Estado amea√ßa o governo!",
                    type: "critical",
                    effect: { stability: -30, military: -10, support: -25 },
                    condition: (state) => state.stability < 40 && state.military > 70
                }
            ];
            
            const availableEvents = events.filter(event => !event.condition || event.condition(gameState));
            if (availableEvents.length > 0) {
                const event = availableEvents[Math.floor(Math.random() * availableEvents.length)];
                logEvent(event.message, event.type);
                
                // Aplicar efeitos do evento
                Object.keys(event.effect).forEach(stat => {
                    if (stat in gameState) {
                        gameState[stat] = Math.max(0, Math.min(100, gameState[stat] + event.effect[stat]));
                    } else if (stat === 'budget') {
                        gameState.budget += event.effect[stat];
                    } else if (stat === 'resources') {
                        gameState.resources += event.effect[stat];
                    } else if (stat === 'energy') {
                        gameState.energy += event.effect[stat];
                    }
                });
                
                updateUI();
                playSFX(event.type === 'critical' ? 'crisis' : 'event');
            }
        }

        function applyEconomicPolicy() {
            gameState.policies.incomeTax = parseInt(document.getElementById('income-tax').value);
            gameState.policies.corporateTax = parseInt(document.getElementById('corporate-tax').value);
            gameState.policies.laborRegulation = parseInt(document.getElementById('labor-regulation').value);
            gameState.policies.environmentRegulation = parseInt(document.getElementById('environment-regulation').value);
            
            // Efeitos das pol√≠ticas
            const laborEffect = gameState.policies.laborRegulation * 5;
            const environmentEffect = gameState.policies.environmentRegulation * 3;
            
            gameState.support += laborEffect;
            gameState.economy -= laborEffect * 0.5;
            gameState.support += environmentEffect;
            gameState.economy -= environmentEffect * 0.3;
            
            logEvent("Pol√≠tica econ√¥mica atualizada.", "neutral");
            updateUI();
            playSFX('policy');
        }

        // Fun√ß√µes militares
        function recruitArmy() {
            if (gameState.budget >= 2000) {
                gameState.budget -= 2000;
                gameState.army += 1000;
                gameState.military += 2;
                logEvent("1,000 novas tropas recrutadas para o ex√©rcito.", "positive");
                updateUI();
                playSFX('military');
            } else {
                logEvent("Or√ßamento insuficiente para recrutamento militar.", "negative");
                playSFX('error');
            }
        }

        function buildNavy() {
            if (gameState.budget >= 5000) {
                gameState.budget -= 5000;
                gameState.navy += 1;
                gameState.military += 3;
                logEvent("Novo navio adicionado √† marinha.", "positive");
                updateUI();
                playSFX('military');
            } else {
                logEvent("Or√ßamento insuficiente para constru√ß√£o naval.", "negative");
                playSFX('error');
            }
        }

        function buildAirforce() {
            if (gameState.budget >= 3000) {
                gameState.budget -= 3000;
                gameState.airforce += 2;
                gameState.military += 2;
                logEvent("Duas novas aeronaves adquiridas para a for√ßa a√©rea.", "positive");
                updateUI();
                playSFX('military');
            } else {
                logEvent("Or√ßamento insuficiente para expans√£o da for√ßa a√©rea.", "negative");
                playSFX('error');
            }
        }

        function counterInsurgency() {
            if (gameState.budget >= 1000) {
                gameState.budget -= 1000;
                gameState.rebelActivity = Math.max(0, gameState.rebelActivity - 10);
                // Melhorar zonas rebeldes
                gameState.zones.forEach(zone => {
                    if (zone.rebel) {
                        zone.stability += 15;
                        if (zone.stability > 50) zone.critical = false;
                    }
                });
                logEvent("Opera√ß√£o de contra-insurg√™ncia lan√ßada. Atividade rebelde reduzida.", "positive");
                updateUI();
                generateZones();
                playSFX('military');
            } else {
                logEvent("Or√ßamento insuficiente para opera√ß√£o de contra-insurg√™ncia.", "negative");
                playSFX('error');
            }
        }

        function borderPatrol() {
            if (gameState.budget >= 500) {
                gameState.budget -= 500;
                gameState.stability += 3;
                logEvent("Patrulha de fronteira intensificada. Estabilidade melhorada.", "positive");
                updateUI();
                playSFX('military');
            } else {
                logEvent("Or√ßamento insuficiente para intensificar patrulha de fronteira.", "negative");
                playSFX('error');
            }
        }

        // Fun√ß√µes diplom√°ticas
        function improveRelations(target) {
            if (gameState.budget >= 1000) {
                gameState.budget -= 1000;
                gameState.relations[target] = Math.min(100, gameState.relations[target] + 10);
                logEvent(`Rela√ß√µes com ${target} melhoradas.`, "positive");
                updateUI();
                playSFX('diplomacy');
            } else {
                logEvent("Or√ßamento insuficiente para iniciativa diplom√°tica.", "negative");
                playSFX('error');
            }
        }

        function joinWTO() {
            if (gameState.budget >= 2000) {
                gameState.budget -= 2000;
                gameState.economy += 10;
                gameState.relations.west += 15;
                logEvent("Ades√£o √† OMC solicitada. Economia e rela√ß√µes com o Ocidente melhoradas.", "positive");
                updateUI();
                playSFX('diplomacy');
            } else {
                logEvent("Or√ßamento insuficiente para solicitar ades√£o √† OMC.", "negative");
                playSFX('error');
            }
        }

        function defenseTreaty() {
            if (gameState.budget >= 1500) {
                gameState.budget -= 1500;
                gameState.military += 5;
                gameState.stability += 5;
                logEvent("Tratado de defesa m√∫tua negociado. Capacidade militar e estabilidade melhoradas.", "positive");
                updateUI();
                playSFX('diplomacy');
            } else {
                logEvent("Or√ßamento insuficiente para negociar tratado de defesa.", "negative");
                playSFX('error');
            }
        }

        function logEvent(message, type = "neutral") {
            const eventsLog = document.getElementById('events-log');
            const eventElement = document.createElement('div');
            eventElement.className = `event ${type}`;
            eventElement.textContent = `Turno ${gameState.year - 1984}: ${message}`;
            
            eventsLog.appendChild(eventElement);
            eventsLog.scrollTop = eventsLog.scrollHeight;
            
            gameState.events.push({ message, type, turn: gameState.year - 1984 });
            
            // Manter apenas os √∫ltimos 10 eventos
            while (eventsLog.children.length > 11) {
                eventsLog.removeChild(eventsLog.children[1]);
            }
        }

        function checkGameState() {
            // Verificar derrota
            if (gameState.stability <= 0) {
                alert("GAME OVER! O seu governo entrou em colapso devido √† instabilidade.");
                resetGame();
                return;
            }
            
            if (gameState.support <= 0) {
                alert("GAME OVER! O povo se revoltou contra seu governo.");
                resetGame();
                return;
            }
            
            // Verificar vit√≥ria
            if (gameState.stability >= 90 && gameState.economy >= 80 && gameState.support >= 85 && gameState.year >= 1990) {
                alert("VIT√ìRIA! Voc√™ transformou a na√ß√£o em uma pot√™ncia pr√≥spera e est√°vel!");
                resetGame();
                return;
            }
        }

        function resetGame() {
            // Resetar estado b√°sico
            gameState.year = 1985;
            gameState.stability = 65;
            gameState.economy = 45;
            gameState.support = 70;
            gameState.military = 85;
            gameState.budget = 15000;
            gameState.resources = 2500;
            gameState.population = 125000;
            gameState.energy = 1200;
            gameState.government = "Rep√∫blica Democr√°tica";
            gameState.regime = "democracy";
            gameState.inflation = 2.5;
            gameState.rebelActivity = 15;
            gameState.crisis = null;
            
            // Resetar fac√ß√µes
            gameState.factions = {
                capitalists: 40,
                communists: 25,
                nationalists: 60,
                religious: 35,
                militarists: 55,
                liberals: 30
            };
            
            // Resetar rela√ß√µes
            gameState.relations = {
                west: 50,
                east: 40,
                neighbors: 60
            };
            
            const eventsLog = document.getElementById('events-log');
            eventsLog.innerHTML = '<h3>üì∞ Eventos e Not√≠cias</h3>';
            
            // Resetar UI
            document.querySelectorAll('.regime-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.regime === 'democracy') btn.classList.add('active');
            });
            
            document.querySelectorAll('.difficulty-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.difficulty === 'normal') btn.classList.add('active');
            });
            
            document.querySelectorAll('.map-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.map === 'tropical') btn.classList.add('active');
            });
            
            initGame();
        }

        // ========== INICIALIZA√á√ÉO DO JOGO ==========

        function initGame() {
            setupEventListeners();
            generateZones();
            updateActions();
            updateUI();
            initVisualAudioSystem();
            logEvent("Bem-vindo ao Tropical Revolution Expandido! Sua miss√£o √© governar esta na√ß√£o enquanto enfrenta desafios complexos.", "neutral");
            logEvent("Escolha seu regime pol√≠tico com cuidado - cada um tem vantagens e desvantagens √∫nicas.", "neutral");
        }

        // Iniciar o jogo quando a p√°gina carregar
        window.onload = initGame;
    </script>
</body>
</html>
